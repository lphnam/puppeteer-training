"use strict";function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_nonIterableSpread()}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function _iterableToArray(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function _arrayWithoutHoles(e){if(Array.isArray(e)){for(var r=0,t=new Array(e.length);r<e.length;r++)t[r]=e[r];return t}}var puppeteer=require("puppeteer"),LOGIN_URL="https://www.instagram.com/accounts/login/",browser=null,page=null,instagram={login:function(r,t){var n,a,i,o,u,c,s,l,d,g,p,v,m,w,f,x,h;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(puppeteer.launch({args:["--incognito"],headless:!1}));case 2:return browser=e.sent,e.next=5,regeneratorRuntime.awrap(browser.newPage());case 5:return page=e.sent,e.next=8,regeneratorRuntime.awrap(page.goto(LOGIN_URL,{waitUntil:"networkidle2"}));case 8:return e.next=10,regeneratorRuntime.awrap(page.type('input[name="username"]',r,{delay:20}));case 10:return e.next=12,regeneratorRuntime.awrap(page.type('input[name="password"]',t,{delay:20}));case 12:return e.next=14,regeneratorRuntime.awrap(page.click('button[type="submit"]',{delay:20}));case 14:return e.next=16,regeneratorRuntime.awrap(page.waitFor(5e3));case 16:return e.next=18,regeneratorRuntime.awrap(page.$x("//button[contains(text(), 'Not Now')]"));case 18:if(0<(n=e.sent).length)return e.next=22,regeneratorRuntime.awrap(n[0].click());e.next=24;break;case 22:e.next=25;break;case 24:console.log("Not notify button");case 25:return e.next=27,regeneratorRuntime.awrap(page.goto("https://www.instagram.com/".concat(r),{waitUntil:"networkidle2"}));case 27:return e.next=29,regeneratorRuntime.awrap(page.waitFor(2e3));case 29:return e.next=31,regeneratorRuntime.awrap(page.$("#react-root > section > main > div > header > section > ul > li:nth-child(2) > a"));case 31:return a=e.sent,e.next=34,regeneratorRuntime.awrap(a.evaluate(function(e){return e.click()}));case 34:return e.next=36,regeneratorRuntime.awrap(page.waitFor(3e3));case 36:return i='div[role="dialog"] > div > div:nth-child(2)',e.next=39,regeneratorRuntime.awrap(page.waitForSelector('div[role="dialog"] > div > div:nth-child(2) > ul'));case 39:return e.next=41,regeneratorRuntime.awrap(scrollDown(i,page));case 41:return console.log("getting followers"),e.next=44,regeneratorRuntime.awrap(page.$$('div[role="dialog"] > div > div:nth-child(2) > ul > div > li > div > div:nth-child(2) > div > div > div> a'));case 44:return o=e.sent,u=['div[role="dialog"] > div > div:nth-child(2) > ul > div > li > div > div > div > a > img','div[role="dialog"] > div > div:nth-child(2) > ul > div > li > div > div > div > span > img'],e.next=48,regeneratorRuntime.awrap(u.reduce(function(r,t){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(r);case 2:return n=e.sent,e.next=5,regeneratorRuntime.awrap(page.$$eval(t,function(e){return e.map(function(e){return{username:e.getAttribute("alt").split(/([,])/g)[0],avatar:e.getAttribute("src")}})}));case 5:return a=e.sent,e.abrupt("return",n.concat(_toConsumableArray(a)));case 7:case"end":return e.stop()}})},Promise.resolve([])));case 48:return c=e.sent,e.next=51,regeneratorRuntime.awrap(Promise.all(o.map(function(r){var t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=regeneratorRuntime,e.next=3,regeneratorRuntime.awrap(r.getProperty("innerText"));case 3:return e.t1=e.sent.jsonValue(),e.next=6,e.t0.awrap.call(e.t0,e.t1);case 6:return t=e.sent,n=c.find(function(e){return e.username===t||{avatar:""}}),e.next=10,regeneratorRuntime.awrap(n.avatar);case 10:return e.t2=e.sent,e.t3=t,e.abrupt("return",{avatar:e.t2,username:e.t3});case 13:case"end":return e.stop()}})})));case 51:return s=e.sent,e.next=54,regeneratorRuntime.awrap(page.$('div[role="dialog"] > div > div > div > div:nth-child(3) > button'));case 54:return l=e.sent,e.next=57,regeneratorRuntime.awrap(l.evaluate(function(e){return e.click()}));case 57:return e.next=59,regeneratorRuntime.awrap(page.$('div[id="react-root"] > section > main > div > header > section > ul > li:nth-child(3) > a'));case 59:return d=e.sent,e.next=62,regeneratorRuntime.awrap(d.evaluate(function(e){return e.click()}));case 62:return e.next=64,regeneratorRuntime.awrap(page.waitFor(3e3));case 64:return g='div[role="dialog"] > div > div:nth-child(3)',e.next=67,regeneratorRuntime.awrap(page.waitForSelector('div[role="dialog"] > div > div:nth-child(3) > ul'));case 67:return e.next=69,regeneratorRuntime.awrap(scrollDown(g,page));case 69:return console.log("get following...."),e.next=72,regeneratorRuntime.awrap(page.$$('div[role="dialog"] > div > div:nth-child(3) > ul > div > li > div > div:nth-child(2) > div > div > div > a'));case 72:return p=e.sent,e.next=75,regeneratorRuntime.awrap(page.waitForSelector('div[role="dialog"] > div > div:nth-child(3) > ul > div > li > div > div > div > a > img'));case 75:return v=['div[role="dialog"] > div > div:nth-child(3) > ul > div > li > div > div > div > a > img','div[role="dialog"] > div > div:nth-child(3) > ul > div > li > div > div > div > span > img'],e.next=78,regeneratorRuntime.awrap(v.reduce(function(r,t){var n,a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(r);case 2:return n=e.sent,e.next=5,regeneratorRuntime.awrap(page.$$eval(t,function(e){return e.map(function(e){return{username:e.getAttribute("alt").split(/([,])/g)[0],avatar:e.getAttribute("src")}})}));case 5:return a=e.sent,e.abrupt("return",n.concat(_toConsumableArray(a)));case 7:case"end":return e.stop()}})},Promise.resolve([])));case 78:return m=e.sent,e.next=81,regeneratorRuntime.awrap(Promise.all(p.map(function(r){var t,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=regeneratorRuntime,e.next=3,regeneratorRuntime.awrap(r.getProperty("innerText"));case 3:return e.t1=e.sent.jsonValue(),e.next=6,e.t0.awrap.call(e.t0,e.t1);case 6:return t=e.sent,n=m.find(function(e){return e.username===t||{avatar:""}}),e.next=10,regeneratorRuntime.awrap(n.avatar);case 10:return e.t2=e.sent,e.t3=t,e.abrupt("return",{avatar:e.t2,username:e.t3});case 13:case"end":return e.stop()}})})));case 81:return w=e.sent,f=s.length,x=w.length,console.log("Follower:".concat(f)),console.log("Following:".concat(x)),w.filter(function(r){return!s.find(function(e){return e.username===r.username})}),s.filter(function(r){return!w.find(function(e){return e.username===r.username})}),h={followerCount:f,followingCount:x,followers:s,following:w},e.abrupt("return",h);case 91:case"end":return e.stop()}})},end:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(browser.close());case 2:case"end":return e.stop()}})}};function scrollDown(r,t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(t.evaluate(function(r){var a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=document.querySelector(r),e.next=3,regeneratorRuntime.awrap(new Promise(function(r,e){var t=0,n=setInterval(function(){var e=a.scrollHeight;a.scrollTop=1e8,e<=(t+=100)&&(clearInterval(n),r())})},100));case 3:case"end":return e.stop()}})},r));case 2:case"end":return e.stop()}})}module.exports=instagram;